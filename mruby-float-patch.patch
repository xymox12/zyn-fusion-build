diff --git a/include/mruby.h b/include/mruby.h
index 7deb3cbe..d0faebd6 100644
--- a/include/mruby.h
+++ b/include/mruby.h
@@ -38,6 +38,11 @@
 #include <stdint.h>
 #include <stddef.h>
 #include <limits.h>
+#include <float.h>
+
+#ifndef DBL_EPSILON
+#define DBL_EPSILON 1e-6
+#endif
 
 #ifdef __cplusplus
 #ifndef SIZE_MAX
diff --git a/src/backtrace.c b/src/backtrace.c
index 991a67d0..60b3958b 100644
--- a/src/backtrace.c
+++ b/src/backtrace.c
@@ -73,6 +73,8 @@ each_backtrace(mrb_state *mrb, ptrdiff_t ciidx, mrb_code *pc0, each_backtrace_fu
 
 #ifndef MRB_DISABLE_STDIO
 
+char superhack[1024*20];
+
 static void
 print_backtrace(mrb_state *mrb, mrb_value backtrace)
 {
diff --git a/src/fmt_fp.c b/src/fmt_fp.c
index 1f1af676..9b1e4f58 100644
--- a/src/fmt_fp.c
+++ b/src/fmt_fp.c
@@ -38,6 +38,10 @@ SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 #include <mruby.h>
 #include <mruby/string.h>
 
+#ifndef LDBL_EPSILON
+#define LDBL_EPSILON 1e-6
+#endif
+
 struct fmt_args {
   mrb_state *mrb;
   mrb_value str;
